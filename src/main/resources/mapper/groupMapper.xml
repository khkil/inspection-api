<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.backend.api.group.GroupMapper">
    <insert id="insertGroup" parameterType="com.example.backend.api.group.Group" useGeneratedKeys="true" keyProperty="idx">
        INSERT INTO `group`(`name`, `tel`, `address`, `address_sub`, `contact_name`, `contact_email`, `contact_tel`)
        VALUES  (#{name}, #{tel}, #{address}, #{addressSub}, #{contactName}, #{contactEmail}, #{contactTel} )
    </insert>

    <select id="getGroupList"  resultMap="groupListMap">
        SELECT * FROM `group`;
    </select>


    <resultMap id="groupListMap" type="com.example.backend.api.group.Group" autoMapping="true">
        <id property="idx" column="idx"></id>
        <collection property="grades" column="idx"  select="getGroupGrades"/>
    </resultMap>
    <select id="getGroupDetail" parameterType="int" resultMap="groupListMap">
        SELECT * FROM `group` WHERE idx = #{idx}
    </select>

    <select id="getGroupGrades" resultType="int">
        SELECT user_grade FROM `user` WHERE group_idx = #{idx} GROUP BY user_grade;
    </select>
    <select id="getGroupInspections" resultType="inspection">
        SELECT u.inspection_idx, i.inspection_name FROM `user` u
        LEFT OUTER JOIN inspection i
            ON u.inspection_idx = i.inspection_idx
        WHERE u.group_idx = #{idx}
        GROUP BY i.inspection_idx;;
    </select>

    <!-- admin -->
    <select id="getAdminGroupList"  resultType="group">
        SELECT * FROM `group`
    </select>

</mapper>
